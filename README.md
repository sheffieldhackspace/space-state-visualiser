# Space State Visualiser

A system to visualise open/closed state, and the on/off state of various sensors/objects/sockets in Sheffield Hackspace.

![illustration of hackspace, showing green and red objects](images/state_example.png)

## Visuals

The visuals are generated by [nnenov](https://www.nnenov.eu/)

## Development

install

```bash
python -m venv env
source ./env/bin/activate
pip install -r requirements.txt
echo "[]" > history.json
```

convert images

```bash
# the info beamer Pi does not render images very well, so we downsize them to
#   reduce the response times from 30s to 3s
for file in ./*; do
  fn="${file%.*}"; convert -resize 800x "${file}" "${fn}.webp"
done
scp ./*.webp sensepi:/usr/shhm/space-state-visualiser/static/icons/
sed -i templates/index.html 's+png+webp+'
```

Flask debug

```bash
flask --app server run
```

test MQTT commands

```bash
mosquitto_pub -h mosquitto.shhm.uk -t "SHHNoT/lights/room_d/command/switch:0" -m on
mosquitto_pub -h mosquitto.shhm.uk -t "state/SS/943CC682D374/input" -m '{"Door Open": false}'
```

run in 'production'

```bash
pip install gunicorn eventlet
gunicorn -b 0.0.0.0 --worker-class eventlet -w 1 server:app
```
