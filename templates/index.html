<!DOCTYPE html>
<html>
  <head>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
      integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
      crossorigin="anonymous"
    ></script>
    <script type="text/javascript" charset="utf-8">
      {% if do_socket %}
      // update image with ID with state (NA, on, or off)
      function update_image(listener, state) {
        const id = listener["id"];
        const url = "/static/icons/" + id + "." + state + ".png";

        console.groupCollapsed(`update <${id}> to <${state}>`);
        console.log(listener);
        console.log("url: " + window.location + url);
        console.groupEnd();

        const image = document.getElementById(id);
        image.setAttribute("src", url);
      }

      const socket = io();
      socket.on("connect", function () {
        // socket.emit("my event", { data: "I'm connected!" });
      });
      socket.on("status-update", function (data) {
        const listener = data[0];
        const new_state = data[1];
        update_image(listener, new_state);
      });
      {% endif %}
    </script>
    <script>
      // clock
      document.addEventListener("DOMContentLoaded", () => {
        const clock = document.getElementById("clock");
        let interval = setInterval(function () {
          clock.textContent = new Date().toLocaleTimeString("en-GB");
        }, 1000);
      });
    </script>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        background-color: black;
        z-index: -1001;
        position: relative;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      #state {
        position: relative;
        aspect-ratio: 1920/1080;
        width: 100%;
        height: auto;
        max-width: 100%;
        max-height: 100%;
      }
      #state img#space {
        position: absolute;
        aspect-ratio: 1920/1080;
        width: 100%;
        height: auto;
        max-width: 100%;
        max-height: 100%;
      }
      #state img.icon {
        position: absolute;
        height: auto;
        width: auto;
        left: var(--x);
        top: var(--y);
      }
      #space {
        z-index: -1000;
      }
      #clock {
        position: absolute;
        margin: 2rem 7rem;
        top: 0;
        right: 1rem;
        color: white;
        font-size: 4rem;
        font-family: "Courier New", Courier, monospace;
      }
      #statebuttons {
        position: absolute;
        bottom: 0;
        left: 0;
        display: flex;
        gap: 1rem;
        margin: 1rem;
      }
      #statebuttons a,
      #statebuttons a:visited {
        color: black;
        background-color: white;
        border-radius: 1rem;
        padding: 1rem;
        text-decoration: none;
      }
      #statebuttons a.active {
        background-color: darkgreen;
      }
    </style>
  </head>
  <body>
    <p id="clock"></p>
    <div id="state">
      <img id="space" src="/static/space.jpg" />
      {% for listener in listeners %}
      <img
        id="{{ listener.id }}"
        class="icon"
        src="/static/icons_crop/{{ listener.id }}.{% if view_state %}{{ view_state }}{% else %}{% if listener.lastState %}{{ listener.lastState }}{% else %}NA{% endif %}{% endif %}.png"
        style="--x:{{ listener.x / 1920 * 100 }}%; --y:{{ listener.y / 1080 * 100 }}%; {%if
        listener.z
        %}z-index: {{ listener.z }}
        {%
        endif
        %}"
      />
      {% endfor %}
    </div>
    {% if view_state %}
    <div id="statebuttons">
      <a href="?state=NA" class="{% if view_state == 'NA' %}active{% endif %}">
        NA
      </a>
      <a href="?state=on" class="{% if view_state == 'on' %}active{% endif %}">
        on
      </a>
      <a
        href="?state=off"
        class="{% if view_state == 'off' %}active{% endif %}"
      >
        off
      </a>
    </div>
    {% endif %}
  </body>
</html>
